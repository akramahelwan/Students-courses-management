<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>School Manager</title>
  <style>
    :root {
      --bg: #121212;
      --card: #1f1f1f;
      --text: #e0e0e0;
      --accent: #4e9eff;
      --danger: #ff5c5c;
      --success: #4fff87;
    }
    * { box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 { margin: 1rem; color: var(--accent); }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      width: 90%;
      max-width: 1200px;
      margin-bottom: 3rem;
    }
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 0 10px #0006;
      transition: transform 0.2s;
    }
    .card:hover { transform: translateY(-3px); }
    h2 { border-bottom: 1px solid #333; padding-bottom: .5rem; }
    form {
      display: flex;
      gap: .5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    input, select {
      padding: .5rem;
      border-radius: 8px;
      border: none;
      flex: 1;
      background: #2a2a2a;
      color: var(--text);
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      padding: .5rem 1rem;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { background: #3187e8; }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border-bottom: 1px solid #333;
      padding: .5rem;
      text-align: left;
    }
    td button { margin-right: .3rem; }
    .msg { margin-top: .5rem; color: var(--success); text-align: center; }
    @media (max-width: 800px) { .container { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h1>üéì School Manager Dashboard</h1>

  <div class="container">
    <!-- Courses Section -->
    <div class="card" id="courses-section">
      <h2>Courses</h2>
      <form id="course-form">
        <input type="text" id="course-title" placeholder="Title" required>
        <input type="text" id="course-code" placeholder="Code" required>
        <button type="submit">Add</button>
      </form>
      <table id="courses-table">
        <thead><tr><th>Title</th><th>Code</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Students Section -->
    <div class="card" id="students-section">
      <h2>Students</h2>
      <form id="student-form">
        <input type="text" id="student-name" placeholder="Name" required>
        <input type="email" id="student-email" placeholder="Email">
        <button type="submit">Add</button>
      </form>
      <table id="students-table">
        <thead><tr><th>Name</th><th>Email</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Registration Section -->
  <div class="card" style="width:90%;max-width:1200px">
    <h2>üìö Manage Registrations</h2>
    <div style="display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1rem;">
      <select id="student-select"></select>
      <select id="course-select"></select>
      <button id="register-btn">Register</button>
      <button id="unregister-btn" style="background:var(--danger)">Unregister</button>
    </div>
    <div id="registered-courses"></div>
    <div class="msg" id="msg"></div>
  </div>

  <script>
    const API = "/api"; // ŸÖÿ≥ÿßÿ± ŸÜÿ≥ÿ®Ÿä
    const msg = document.getElementById("msg");

    // ========== Courses ==========
    async function loadCourses() {
      const res = await fetch(API + "/courses");
      const data = await res.json();
      const tbody = document.querySelector("#courses-table tbody");
      tbody.innerHTML = "";
      data.forEach(c => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${c.title}</td>
          <td>${c.code}</td>
          <td>
            <button onclick="editCourse('${c._id}','${c.title}','${c.code}')">‚úèÔ∏è</button>
            <button onclick="deleteCourse('${c._id}')">üóëÔ∏è</button>
          </td>`;
        tbody.appendChild(tr);
      });
      refreshSelects();
    }

    let editingCourse = null;
    document.getElementById("course-form").onsubmit = async e => {
      e.preventDefault();
      const title = document.getElementById("course-title").value;
      const code = document.getElementById("course-code").value;
      const method = editingCourse ? "PUT" : "POST";
      const url = editingCourse ? `${API}/courses/${editingCourse}` : `${API}/courses`;
      const res = await fetch(url, {
        method, headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, code })
      });
      editingCourse = null;
      document.getElementById("course-title").value = "";
      document.getElementById("course-code").value = "";
      loadCourses();
    };
    function editCourse(id, title, code) {
      editingCourse = id;
      document.getElementById("course-title").value = title;
      document.getElementById("course-code").value = code;
    }
    async function deleteCourse(id) {
      if (!confirm("Delete this course?")) return;
      await fetch(`${API}/courses/${id}`, { method: "DELETE" });
      loadCourses();
    }

    // ========== Students ==========
    async function loadStudents() {
      const res = await fetch(API + "/students");
      const data = await res.json();
      const tbody = document.querySelector("#students-table tbody");
      tbody.innerHTML = "";
      data.forEach(s => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${s.name}</td>
          <td>${s.email || ""}</td>
          <td>
            <button onclick="editStudent('${s._id}','${s.name}','${s.email || ""}')">‚úèÔ∏è</button>
            <button onclick="deleteStudent('${s._id}')">üóëÔ∏è</button>
          </td>`;
        tbody.appendChild(tr);
      });
      refreshSelects();
    }

    let editingStudent = null;
    document.getElementById("student-form").onsubmit = async e => {
      e.preventDefault();
      const name = document.getElementById("student-name").value;
      const email = document.getElementById("student-email").value;
      const method = editingStudent ? "PUT" : "POST";
      const url = editingStudent ? `${API}/students/${editingStudent}` : `${API}/students`;
      await fetch(url, {
        method, headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email })
      });
      editingStudent = null;
      document.getElementById("student-name").value = "";
      document.getElementById("student-email").value = "";
      loadStudents();
    };
    function editStudent(id, name, email) {
      editingStudent = id;
      document.getElementById("student-name").value = name;
      document.getElementById("student-email").value = email;
    }
    async function deleteStudent(id) {
      if (!confirm("Delete this student?")) return;
      await fetch(`${API}/students/${id}`, { method: "DELETE" });
      loadStudents();
    }

    // ========== Registration ==========
    async function refreshSelects() {
      const [studentsRes, coursesRes] = await Promise.all([fetch(API + "/students"), fetch(API + "/courses")]);
      const students = await studentsRes.json();
      const courses = await coursesRes.json();
      document.getElementById("student-select").innerHTML = students.map(s => `<option value="${s._id}">${s.name}</option>`).join("");
      document.getElementById("course-select").innerHTML = courses.map(c => `<option value="${c._id}">${c.title}</option>`).join("");
    }

    document.getElementById("register-btn").onclick = async () => {
      const sid = document.getElementById("student-select").value;
      const cid = document.getElementById("course-select").value;
      await fetch(`${API}/students/${sid}/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ courseId: cid })
      });
      showMessage("‚úÖ Registered successfully!");
      showRegisteredCourses();
    };

    document.getElementById("unregister-btn").onclick = async () => {
      const sid = document.getElementById("student-select").value;
      const cid = document.getElementById("course-select").value;
      await fetch(`${API}/students/${sid}/unregister`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ courseId: cid })
      });
      showMessage("‚ùå Unregistered successfully!");
      showRegisteredCourses();
    };

    async function showRegisteredCourses() {
      const sid = document.getElementById("student-select").value;
      if (!sid) return;
      const res = await fetch(`${API}/students/${sid}`);
      const s = await res.json();
      const list = s.registeredCourses || [];
      const div = document.getElementById("registered-courses");
      div.innerHTML = list.length ? `<ul>${list.map(x => `<li>${x.title} (${x.code})</li>`).join("")}</ul>` : "<p>No registered courses</p>";
    }

    function showMessage(text) {
      msg.textContent = text;
      setTimeout(() => msg.textContent = "", 3000);
    }

    // Initial load
    loadCourses();
    loadStudents();
    setTimeout(showRegisteredCourses, 1000);
  </script>
</body>
</html>
